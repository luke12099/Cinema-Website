/*
 * Timepicker Component for Twitter Bootstrap
 *
 * Copyright 2013 Joris de Wit and bootstrap-timepicker contributors
 *
 * Contributors https://github.com/jdewit/bootstrap-timepicker/graphs/contributors
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function(a,d,b){var c=function(e,f){this.widget="";this.$element=a(e);this.defaultTime=f.defaultTime;this.disableFocus=f.disableFocus;this.disableMousewheel=f.disableMousewheel;this.isOpen=f.isOpen;this.minuteStep=f.minuteStep;this.modalBackdrop=f.modalBackdrop;this.orientation=f.orientation;this.secondStep=f.secondStep;this.snapToStep=f.snapToStep;this.showInputs=f.showInputs;this.showMeridian=f.showMeridian;this.showSeconds=f.showSeconds;this.template=f.template;this.appendWidgetTo=f.appendWidgetTo;this.showWidgetOnAddonClick=f.showWidgetOnAddonClick;this.icons=f.icons;this.maxHours=f.maxHours;this.explicitMode=f.explicitMode;this.handleDocumentClick=function(g){var h=g.data.scope;if(!(h.$element.parent().find(g.target).length||h.$widget.is(g.target)||h.$widget.find(g.target).length)){h.hideWidget()}};this._init()};c.prototype={constructor:c,_init:function(){var e=this;if(this.showWidgetOnAddonClick&&(this.$element.parent().hasClass("input-group")&&this.$element.parent().hasClass("bootstrap-timepicker"))){this.$element.parent(".input-group.bootstrap-timepicker").find(".input-group-addon").on({"click.timepicker":a.proxy(this.showWidget,this)});this.$element.on({"focus.timepicker":a.proxy(this.highlightUnit,this),"click.timepicker":a.proxy(this.highlightUnit,this),"keydown.timepicker":a.proxy(this.elementKeydown,this),"blur.timepicker":a.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":a.proxy(this.mousewheel,this)})}else{if(this.template){this.$element.on({"focus.timepicker":a.proxy(this.showWidget,this),"click.timepicker":a.proxy(this.showWidget,this),"blur.timepicker":a.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":a.proxy(this.mousewheel,this)})}else{this.$element.on({"focus.timepicker":a.proxy(this.highlightUnit,this),"click.timepicker":a.proxy(this.highlightUnit,this),"keydown.timepicker":a.proxy(this.elementKeydown,this),"blur.timepicker":a.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":a.proxy(this.mousewheel,this)})}}if(this.template!==false){this.$widget=a(this.getTemplate()).on("click",a.proxy(this.widgetClick,this))}else{this.$widget=false}if(this.showInputs&&this.$widget!==false){this.$widget.find("input").each(function(){a(this).on({"click.timepicker":function(){a(this).select()},"keydown.timepicker":a.proxy(e.widgetKeydown,e),"keyup.timepicker":a.proxy(e.widgetKeyup,e)})})}this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null;this.updateFromElementVal()},clear:function(){this.hour="";this.minute="";this.second="";this.meridian="";this.$element.val("")},decrementHour:function(){if(this.showMeridian){if(this.hour===1){this.hour=12}else{if(this.hour===12){this.hour--;return this.toggleMeridian()}else{if(this.hour===0){this.hour=11;return this.toggleMeridian()}else{this.hour--}}}}else{if(this.hour<=0){this.hour=this.maxHours-1}else{this.hour--}}},decrementMinute:function(f){var e;if(f){e=this.minute-f}else{e=this.minute-this.minuteStep}if(e<0){this.decrementHour();this.minute=e+60}else{this.minute=e}},decrementSecond:function(){var e=this.second-this.secondStep;if(e<0){this.decrementMinute(true);this.second=e+60}else{this.second=e}},elementKeydown:function(f){switch(f.which){case 9:if(f.shiftKey){if(this.highlightedUnit==="hour"){this.hideWidget();break}this.highlightPrevUnit()}else{if((this.showMeridian&&this.highlightedUnit==="meridian")||(this.showSeconds&&this.highlightedUnit==="second")||(!this.showMeridian&&!this.showSeconds&&this.highlightedUnit==="minute")){this.hideWidget();break}else{this.highlightNextUnit()}}f.preventDefault();this.updateFromElementVal();break;case 27:this.updateFromElementVal();break;case 37:f.preventDefault();this.highlightPrevUnit();this.updateFromElementVal();break;case 38:f.preventDefault();switch(this.highlightedUnit){case"hour":this.incrementHour();this.highlightHour();break;case"minute":this.incrementMinute();this.highlightMinute();break;case"second":this.incrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break;case 39:f.preventDefault();this.highlightNextUnit();this.updateFromElementVal();break;case 40:f.preventDefault();switch(this.highlightedUnit){case"hour":this.decrementHour();this.highlightHour();break;case"minute":this.decrementMinute();this.highlightMinute();break;case"second":this.decrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break}},getCursorPosition:function(){var e=this.$element.get(0);if("selectionStart" in e){return e.selectionStart}else{if(b.selection){e.focus();var f=b.selection.createRange(),g=b.selection.createRange().text.length;f.moveStart("character",-e.value.length);return f.text.length-g}}},getTemplate:function(){var i,e,g,h,f,j;if(this.showInputs){e='<input type="text" class="bootstrap-timepicker-hour" maxlength="2"/>';g='<input type="text" class="bootstrap-timepicker-minute" maxlength="2"/>';h='<input type="text" class="bootstrap-timepicker-second" maxlength="2"/>';f='<input type="text" class="bootstrap-timepicker-meridian" maxlength="2"/>'}else{e='<span class="bootstrap-timepicker-hour"></span>';g='<span class="bootstrap-timepicker-minute"></span>';h='<span class="bootstrap-timepicker-second"></span>';f='<span class="bootstrap-timepicker-meridian"></span>'}j='<table><tr><td><a href="#" data-action="incrementHour"><span class="'+this.icons.up+'"></span></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><span class="'+this.icons.up+'"></span></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><span class="'+this.icons.up+'"></span></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><span class="'+this.icons.up+'"></span></a></td>':"")+"</tr><tr><td>"+e+'</td> <td class="separator">:</td><td>'+g+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+h+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+f+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><span class="'+this.icons.down+'"></span></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><span class="'+this.icons.down+'"></span></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><span class="'+this.icons.down+'"></span></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><span class="'+this.icons.down+'"></span></a></td>':"")+"</tr></table>";switch(this.template){case"modal":i='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3>Pick a Time</h3></div><div class="modal-content">'+j+'</div><div class="modal-footer"><a href="#" class="btn btn-primary" data-dismiss="modal">OK</a></div></div>';break;case"dropdown":i='<div class="bootstrap-timepicker-widget dropdown-menu">'+j+"</div>";break}return i},getTime:function(){if(this.hour===""){return""}return this.hour+":"+(this.minute.toString().length===1?"0"+this.minute:this.minute)+(this.showSeconds?":"+(this.second.toString().length===1?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:"")},hideWidget:function(){if(this.isOpen===false){return}this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("hide")}else{this.$widget.removeClass("open")}a(b).off("mousedown.timepicker, touchend.timepicker",this.handleDocumentClick);this.isOpen=false;this.$widget.detach()},highlightUnit:function(){this.position=this.getCursorPosition();if(this.position>=0&&this.position<=2){this.highlightHour()}else{if(this.position>=3&&this.position<=5){this.highlightMinute()}else{if(this.position>=6&&this.position<=8){if(this.showSeconds){this.highlightSecond()}else{this.highlightMeridian()}}else{if(this.position>=9&&this.position<=11){this.highlightMeridian()}}}}},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":if(this.showSeconds){this.highlightSecond()}else{if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}}break;case"second":if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}break;case"meridian":this.highlightHour();break}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":if(this.showMeridian){this.highlightMeridian()}else{if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}}break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}break}},highlightHour:function(){var e=this.$element.get(0),f=this;this.highlightedUnit="hour";if(e.setSelectionRange){setTimeout(function(){if(f.hour<10){e.setSelectionRange(0,1)}else{e.setSelectionRange(0,2)}},0)}},highlightMinute:function(){var e=this.$element.get(0),f=this;this.highlightedUnit="minute";if(e.setSelectionRange){setTimeout(function(){if(f.hour<10){e.setSelectionRange(2,4)}else{e.setSelectionRange(3,5)}},0)}},highlightSecond:function(){var e=this.$element.get(0),f=this;this.highlightedUnit="second";if(e.setSelectionRange){setTimeout(function(){if(f.hour<10){e.setSelectionRange(5,7)}else{e.setSelectionRange(6,8)}},0)}},highlightMeridian:function(){var e=this.$element.get(0),f=this;this.highlightedUnit="meridian";if(e.setSelectionRange){if(this.showSeconds){setTimeout(function(){if(f.hour<10){e.setSelectionRange(8,10)}else{e.setSelectionRange(9,11)}},0)}else{setTimeout(function(){if(f.hour<10){e.setSelectionRange(5,7)}else{e.setSelectionRange(6,8)}},0)}}},incrementHour:function(){if(this.showMeridian){if(this.hour===11){this.hour++;return this.toggleMeridian()}else{if(this.hour===12){this.hour=0}}}if(this.hour===this.maxHours-1){this.hour=0;return}this.hour++},incrementMinute:function(f){var e;if(f){e=this.minute+f}else{e=this.minute+this.minuteStep-(this.minute%this.minuteStep)}if(e>59){this.incrementHour();this.minute=e-60}else{this.minute=e}},incrementSecond:function(){var e=this.second+this.secondStep-(this.second%this.secondStep);if(e>59){this.incrementMinute(true);this.second=e-60}else{this.second=e}},mousewheel:function(g){if(this.disableMousewheel){return}g.preventDefault();g.stopPropagation();var f=g.originalEvent.wheelDelta||-g.originalEvent.detail,h=null;if(g.type==="mousewheel"){h=(g.originalEvent.wheelDelta*-1)}else{if(g.type==="DOMMouseScroll"){h=40*g.originalEvent.detail}}if(h){g.preventDefault();a(this).scrollTop(h+a(this).scrollTop())}switch(this.highlightedUnit){case"minute":if(f>0){this.incrementMinute()}else{this.decrementMinute()}this.highlightMinute();break;case"second":if(f>0){this.incrementSecond()}else{this.decrementSecond()}this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break;default:if(f>0){this.incrementHour()}else{this.decrementHour()}this.highlightHour();break}return false},changeToNearestStep:function(e,f){if(e%f===0){return e}if(Math.round((e%f)/f)){return(e+(f-e%f))%60}else{return e-e%f}},place:function(){if(this.isInline){return}var n=this.$widget.outerWidth(),m=this.$widget.outerHeight(),l=10,q=a(d).width(),p=a(d).height(),i=a(d).scrollTop();var s=parseInt(this.$element.parents().filter(function(){return a(this).css("z-index")!=="auto"}).first().css("z-index"),10)+10;var h=this.component?this.component.parent().offset():this.$element.offset();var f=this.component?this.component.outerHeight(true):this.$element.outerHeight(false);var o=this.component?this.component.outerWidth(true):this.$element.outerWidth(false);var g=h.left,j=h.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left");if(this.orientation.x!=="auto"){this.$widget.addClass("timepicker-orient-"+this.orientation.x);if(this.orientation.x==="right"){g-=n-o}}else{this.$widget.addClass("timepicker-orient-left");if(h.left<0){g-=h.left-l}else{if(h.left+n>q){g=q-n-l}}}var r=this.orientation.y,k,e;if(r==="auto"){k=-i+h.top-m;e=i+p-(h.top+f+m);if(Math.max(k,e)===e){r="top"}else{r="bottom"}}this.$widget.addClass("timepicker-orient-"+r);if(r==="top"){j+=f}else{j-=m+parseInt(this.$widget.css("padding-top"),10)}this.$widget.css({top:j,left:g,zIndex:s})},remove:function(){a("document").off(".timepicker");if(this.$widget){this.$widget.remove()}delete this.$element.data().timepicker},setDefaultTime:function(e){if(!this.$element.val()){if(e==="current"){var f=new Date(),g=f.getHours(),i=f.getMinutes(),j=f.getSeconds(),h="AM";if(j!==0){j=Math.ceil(f.getSeconds()/this.secondStep)*this.secondStep;if(j===60){i+=1;j=0}}if(i!==0){i=Math.ceil(f.getMinutes()/this.minuteStep)*this.minuteStep;if(i===60){g+=1;i=0}}if(this.showMeridian){if(g===0){g=12}else{if(g>=12){if(g>12){g=g-12}h="PM"}else{h="AM"}}}this.hour=g;this.minute=i;this.second=j;this.meridian=h;this.update()}else{if(e===false){this.hour=0;this.minute=0;this.second=0;this.meridian="AM"}else{this.setTime(e)}}}else{this.updateFromElementVal()}},setTime:function(j,f){if(!j){this.clear();return}var l,k,e,h,i,g;if(typeof j==="object"&&j.getMonth){e=j.getHours();h=j.getMinutes();i=j.getSeconds();if(this.showMeridian){g="AM";if(e>12){g="PM";e=e%12}if(e===12){g="PM"}}}else{l=((/a/i).test(j)?1:0)+((/p/i).test(j)?2:0);if(l>2){this.clear();return}k=j.replace(/[^0-9\:]/g,"").split(":");e=k[0]?k[0].toString():k.toString();if(this.explicitMode&&e.length>2&&(e.length%2)!==0){this.clear();return}h=k[1]?k[1].toString():"";i=k[2]?k[2].toString():"";if(e.length>4){i=e.slice(-2);e=e.slice(0,-2)}if(e.length>2){h=e.slice(-2);e=e.slice(0,-2)}if(h.length>2){i=h.slice(-2);h=h.slice(0,-2)}e=parseInt(e,10);h=parseInt(h,10);i=parseInt(i,10);if(isNaN(e)){e=0}if(isNaN(h)){h=0}if(isNaN(i)){i=0}if(i>59){i=59}if(h>59){h=59}if(e>=this.maxHours){e=this.maxHours-1}if(this.showMeridian){if(e>12){l=2;e-=12}if(!l){l=1}if(e===0){e=12}g=l===1?"AM":"PM"}else{if(e<12&&l===2){e+=12}else{if(e>=this.maxHours){e=this.maxHours-1}else{if((e<0)||(e===12&&l===1)){e=0}}}}}this.hour=e;if(this.snapToStep){this.minute=this.changeToNearestStep(h,this.minuteStep);this.second=this.changeToNearestStep(i,this.secondStep)}else{this.minute=h;this.second=i}this.meridian=g;this.update(f)},showWidget:function(){if(this.isOpen){return}if(this.$element.is(":disabled")){return}this.$widget.appendTo(this.appendWidgetTo);a(b).on("mousedown.timepicker, touchend.timepicker",{scope:this},this.handleDocumentClick);this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});this.place();if(this.disableFocus){this.$element.blur()}if(this.hour===""){if(this.defaultTime){this.setDefaultTime(this.defaultTime)}else{this.setTime("0:0:0")}}if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("show").on("hidden",a.proxy(this.hideWidget,this))}else{if(this.isOpen===false){this.$widget.addClass("open")}}this.isOpen=true},toggleMeridian:function(){this.meridian=this.meridian==="AM"?"PM":"AM"},update:function(e){this.updateElement();if(!e){this.updateWidget()}this.$element.trigger({type:"changeTime.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget===false){return}var e=this.hour,f=this.minute.toString().length===1?"0"+this.minute:this.minute,g=this.second.toString().length===1?"0"+this.second:this.second;if(this.showInputs){this.$widget.find("input.bootstrap-timepicker-hour").val(e);this.$widget.find("input.bootstrap-timepicker-minute").val(f);if(this.showSeconds){this.$widget.find("input.bootstrap-timepicker-second").val(g)}if(this.showMeridian){this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)}}else{this.$widget.find("span.bootstrap-timepicker-hour").text(e);this.$widget.find("span.bootstrap-timepicker-minute").text(f);if(this.showSeconds){this.$widget.find("span.bootstrap-timepicker-second").text(g)}if(this.showMeridian){this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian)}}},updateFromWidgetInputs:function(){if(this.$widget===false){return}var e=this.$widget.find("input.bootstrap-timepicker-hour").val()+":"+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(e,true)},widgetClick:function(h){h.stopPropagation();h.preventDefault();var f=a(h.target),g=f.closest("a").data("action");if(g){this[g]()}this.update();if(f.is("input")){f.get(0).setSelectionRange(0,2)}},widgetKeydown:function(g){var f=a(g.target),h=f.attr("class").replace("bootstrap-timepicker-","");switch(g.which){case 9:if(g.shiftKey){if(h==="hour"){return this.hideWidget()}}else{if((this.showMeridian&&h==="meridian")||(this.showSeconds&&h==="second")||(!this.showMeridian&&!this.showSeconds&&h==="minute")){return this.hideWidget()}}break;case 27:this.hideWidget();break;case 38:g.preventDefault();switch(h){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());f.get(0).setSelectionRange(0,2);break;case 40:g.preventDefault();switch(h){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());f.get(0).setSelectionRange(0,2);break}},widgetKeyup:function(f){if((f.which===65)||(f.which===77)||(f.which===80)||(f.which===46)||(f.which===8)||(f.which>=48&&f.which<=57)||(f.which>=96&&f.which<=105)){this.updateFromWidgetInputs()}}};a.fn.timepicker=function(f){var e=Array.apply(null,arguments);e.shift();return this.each(function(){var g=a(this),h=g.data("timepicker"),i=typeof f==="object"&&f;if(!h){g.data("timepicker",(h=new c(this,a.extend({},a.fn.timepicker.defaults,i,a(this).data()))))}if(typeof f==="string"){h[f].apply(h,e)}})};a.fn.timepicker.defaults={defaultTime:"current",disableFocus:false,disableMousewheel:false,isOpen:false,minuteStep:15,modalBackdrop:false,orientation:{x:"auto",y:"auto"},secondStep:15,snapToStep:false,showSeconds:false,showInputs:true,showMeridian:true,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:true,icons:{up:"glyphicon glyphicon-chevron-up",down:"glyphicon glyphicon-chevron-down"},maxHours:24,explicitMode:false};a.fn.timepicker.Constructor=c;a(b).on("focus.timepicker.data-api click.timepicker.data-api",'[data-provide="timepicker"]',function(g){var f=a(this);if(f.data("timepicker")){return}g.preventDefault();f.timepicker()})})(jQuery,window,document);